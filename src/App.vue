<script setup lang="ts">
import { ref, computed } from 'vue'

// eslint-disable-next-line @typescript-eslint/no-explicit-any
function debounce<T extends (...args: any[]) => any>(fn: T, delay: number = 300): (...args: Parameters<T>) => void {
  let timeoutId: number | undefined

  return function (...args: Parameters<T>) {
    if (timeoutId) {
      clearTimeout(timeoutId)
    }

    timeoutId = setTimeout(() => {
      fn(...args)
      timeoutId = undefined
    }, delay)
  }
}

function hexToBytes(hex: string): number[] {
  return hex
    .replace(/\s+/g, '') // Remove whitespace
    .match(/.{2}/g) // Split into pairs
    ?.map((byte) => parseInt(byte, 16))
}

function bytesToUTF8(bytes: number[] | Uint8Array): string {
  return new TextDecoder().decode(new Uint8Array(bytes))
}

const input = ref(
  '\\x0a0c08b498f6bb0610eca0f6bb062a0b120234302a0530343331302a0b120234302a0530393434302a0b120234302a0530353038352a0b120234302a0530333634302a0b120234302a0530313336362a0b120234302a0530353534312a0b120234302a0531313230372a0b120234302a0530353534302a0b120234302a0530353534382a0b120234302a0530353537342a0b120234302a0530353534322a0b120234302a0531343638312a0b120234302a0530353536302a0b120234302a0530353534362a0b120234302a0531343734302a0b120234302a0531303836352a0b120234302a0530373732332a0b120234302a0530373732372a0b120234302a0530373732392a0b120234302a0531323532332a0b120234302a0530373634312a0b120234302a0530373733312a0b120234302a0530373732302a0b120234302a0530303236312a0b120234302a0530363133352a0b120234302a0530363132373003380242200a1e0a1868747470733a2f2f7777772e726964657274612e636f6d2f1202656e52330a310a2b526564756365642053657276696365206f6e20233430204c616b6576696577e280934c656520536f7574681202656e5ade010adb010ad4014743525441205345525649434520414c4552540d0a0d0a574841543a0d0a526564756365642053657276696365206f6e20233430204c616b6576696577e280934c656520536f7574680d0a0d0a5748593a0d0a4d656368616e6963616c2050726f626c656d0d0a0d0a5748454e3a0d0a312f372f3230323520333a31393a303020504d20756e74696c20312f372f3230323520333a33373a303020504d0d0a0d0a57484552453a0d0a454444592052442026205441465420415620746f204d41594649454c442052442026204c454520424c56441202656e62330a310a2b526564756365642053657276696365206f6e20233430204c616b6576696577e280934c656520536f7574681202656e6a9c010a99010a9201526564756365642053657276696365206f6e20233430204c616b6576696577e280934c656520536f7574682062656361757365206f66204d656368616e6963616c2050726f626c656d20617420454444592052442026205441465420415620746f204d41594649454c442052442026204c454520424c564420756e74696c20312f372f3230323520333a33373a303020504d1202656e8a011a0a180a124d656368616e6963616c2050726f626c656d1202656e9201170a150a0f5265647563656420536572766963651202656ec2b2041d0a0534323531341201301a1132303235303130372031353a31313a3334',
)

const output = computed(() => {
  let val = input.value
  const prefix = '\\x'
  if (val.startsWith(prefix)) {
    val = val.slice(prefix.length)
  }
  val = bytesToUTF8(hexToBytes(val))
  return val
})

const update = debounce((e: Event) => {
  if (e.target) {
    const targetValue = (e.target as HTMLTextAreaElement).value
    input.value = targetValue
  }
}, 100)
</script>

<template>
  <header></header>

  <main>
    <div class="editor">
      <textarea class="input" :value="input" @input="update"></textarea>
      <div>
        Auto-detected: Hexadecimal<br />
        Choose a different type:
        <select>
          <option>Base 36</option>
          <option>Base 64</option>
          <option>Base 64 URL</option>
          <option>C Escaped</option>
          <option selected>Hexadecimal</option>
          <option>URL Encoded</option>
        </select>
      </div>
    </div>
    <div class="output" v-html="output"></div>
  </main>

  <footer></footer>
</template>

<style scoped></style>
